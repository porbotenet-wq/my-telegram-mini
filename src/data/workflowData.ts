export interface WorkflowStep {
  stage: string;
  sub: string;
  from: string;
  action: string;
  to: string;
  deadline: string;
  doc: string;
  trigger: string;
}

export const STAGE_COLORS: Record<string, string> = {
  'Договорной этап': '#70a1ff',
  'Запуск проекта': '#00d4aa',
  'Проектные работы': '#c084fc',
  'Снабжение': '#70a1ff',
  'Производство': '#fb923c',
  'Монтаж': '#ffb347',
  'ПТО': '#34d399',
  'Контроль': '#ff4757',
};

export const WORKFLOW: WorkflowStep[] = [
  // --- Договорной этап ---
  { stage: 'Договорной этап', sub: 'Подписание договора', from: 'Договорной отдел', action: 'Подписание договора с заказчиком', to: 'Руководитель проекта', deadline: 'Дата подписания', doc: 'Договор, Смета', trigger: 'Факт подписания договора' },
  { stage: 'Договорной этап', sub: 'Передача документов', from: 'Договорной отдел', action: 'Направить договор со сметой + контакты заказчика РП', to: 'Руководитель проекта', deadline: 'Сутки с подписания', doc: 'Договор, Смета, Контакты', trigger: 'Получение документов РП' },
  // --- Запуск проекта ---
  { stage: 'Запуск проекта', sub: 'Составление ГПР', from: 'Руководитель проекта', action: 'Составить внутренний ГПР и разослать по отделам', to: 'Все отделы', deadline: 'Сутки с подписания', doc: 'ГПР', trigger: 'Утверждение ГПР' },
  { stage: 'Запуск проекта', sub: 'Назначение ответственных', from: 'Руководитель проекта', action: 'Определить ответственных за ОПР, КМ, КМД', to: 'Проектный отдел', deadline: 'Сутки с подписания', doc: 'Приказ/Уведомление', trigger: '' },
  { stage: 'Запуск проекта', sub: 'Подготовка ИРД', from: 'Руководитель проекта', action: 'Подготовить исходно-разрешительную документацию', to: 'Монтажное подразделение', deadline: 'До начала работ', doc: 'АКТ допуск на объект', trigger: 'Получение допуска' },
  { stage: 'Запуск проекта', sub: 'Согласование ГПР', from: 'Руководитель проекта', action: 'Подписать ГПР с Проектным, Снабжением, Производством, Монтажом', to: 'Все отделы', deadline: '2 суток с подписания', doc: 'Подписанный ГПР', trigger: 'Загрузить ГПР в 1С' },
  // --- Проектные работы ---
  { stage: 'Проектные работы', sub: 'ОПР', from: 'Проектный отдел', action: 'Определить систему, произвести статический расчёт, подобрать сечение профилей, согласовать образцы с заказчиком', to: 'Руководитель проекта', deadline: '5 суток с получения документации', doc: 'Статика, расчёты, Лист согласования', trigger: 'Запуск материалов в работу' },
  { stage: 'Проектные работы', sub: 'КМ', from: 'Проектный отдел', action: 'Деталировка фасадов и планов, спецификации, ВОР, разрезы, узлы, ТЗ на сопутствующие работы', to: 'Отдел снабжения', deadline: 'По ГПР', doc: 'Спецификации, ВОР', trigger: 'Закупка материалов — только после согласования РП' },
  { stage: 'Проектные работы', sub: 'КМД', from: 'Проектный отдел', action: 'Наложение геодезии, чертежи кронштейнов, разработка КМД, заявка на стеклопакеты, монтажные схемы', to: 'Производственный отдел', deadline: 'По ГПР', doc: 'КМД, Монтажные схемы', trigger: 'Производство конструкций' },
  { stage: 'Проектные работы', sub: 'Геодезия', from: 'Руководитель проекта', action: 'Предоставить геодезическую съёмку (2D, 3D) в проектный отдел', to: 'Проектный отдел', deadline: 'Индивидуально', doc: 'Геодезия', trigger: 'Наложение на фасады' },
  // --- Снабжение ---
  { stage: 'Снабжение', sub: 'Получение заявок', from: 'Проектный отдел', action: 'Направить заявки на материалы (место отгрузки: объект/производство). Только после согласования РП, РП — в копию', to: 'Отдел снабжения', deadline: 'По ГПР', doc: 'Заявки на материалы', trigger: 'Закупка' },
  { stage: 'Снабжение', sub: 'Закупка', from: 'Отдел снабжения', action: 'Закупить профиль, комплектующие, стеклопакеты, кронштейны', to: 'Производство / Объект', deadline: 'По ГПР', doc: 'Заказ, ТТН', trigger: 'Поставка' },
  { stage: 'Снабжение', sub: 'Уведомление об отгрузке', from: 'Отдел снабжения', action: 'Уведомить производство об отгрузке материалов за сутки. РП держит на контроле', to: 'Производственный отдел', deadline: 'За сутки', doc: 'Уведомление', trigger: 'Подготовка к приёмке' },
  { stage: 'Снабжение', sub: 'Организация транспорта', from: 'Отдел снабжения', action: 'Организовать машину для транспортировки конструкций по запросу производства', to: 'Производственный отдел', deadline: 'По запросу', doc: 'Заявка на транспорт', trigger: 'Отгрузка конструкций' },
  // --- Производство ---
  { stage: 'Производство', sub: 'Передача ВОР и ГПР', from: 'Руководитель проекта', action: 'Направить ВОР и ГПР (с увязкой сроков КМД, поставок) в производственный отдел', to: 'Производственный отдел', deadline: 'После получения ВОР', doc: 'ВОР, ГПР', trigger: '' },
  { stage: 'Производство', sub: 'КМД', from: 'Проектный отдел', action: 'Направить КМД на почту производства, РП — в копию. РП контролирует сроки выдачи', to: 'Производственный отдел', deadline: 'По ГПР', doc: 'КМД', trigger: 'Проверка КМД' },
  { stage: 'Производство', sub: 'Приёмка материалов', from: 'Производственный отдел', action: 'Пересчитать материал, подписать ТТН, фотофиксация → направить в снабжение и РП', to: 'Отдел снабжения, РП', deadline: 'В день отгрузки', doc: 'ТТН, Фото', trigger: '' },
  { stage: 'Производство', sub: 'Передача М15', from: 'Производственный отдел', action: 'Передать компании-производителю материал по форме М15, направить фото М15', to: 'Компания-производитель', deadline: 'В день отгрузки', doc: 'Форма М15', trigger: 'Начало производства' },
  { stage: 'Производство', sub: 'Мягкая накладная', from: 'Производственный отдел', action: 'На момент отгрузки — направить мягкую накладную РП и в WhatsApp группу объекта', to: 'РП, Группа объекта', deadline: 'На момент отгрузки', doc: 'Мягкая накладная', trigger: '' },
  { stage: 'Производство', sub: 'Уведомление об отгрузке конструкций', from: 'Производственный отдел', action: 'Информировать снабжение об отгрузке готовых конструкций (длина, вес, объём) за 2 суток', to: 'Отдел снабжения', deadline: 'За двое суток', doc: 'Уведомление', trigger: 'Организация транспорта' },
  // --- Монтаж ---
  { stage: 'Монтаж', sub: 'Монтаж кронштейнов', from: 'Монтажное подразделение', action: 'Монтаж кронштейнов', to: '-', deadline: 'По ГПР', doc: 'Акт скрытых работ', trigger: 'Монтаж каркаса' },
  { stage: 'Монтаж', sub: 'Монтаж каркаса', from: 'Монтажное подразделение', action: 'Монтаж каркаса', to: '-', deadline: 'По ГПР', doc: 'Акт скрытых работ', trigger: 'Монтаж заполнения' },
  { stage: 'Монтаж', sub: 'Монтаж заполнения', from: 'Монтажное подразделение', action: 'Монтаж заполнения (стеклопакеты)', to: '-', deadline: 'По ГПР', doc: '-', trigger: 'Монтаж открывающих' },
  { stage: 'Монтаж', sub: 'Монтаж прижимных планок', from: 'Монтажное подразделение', action: 'Монтаж прижимных планок, декоративных крышек', to: '-', deadline: 'По ГПР', doc: '-', trigger: 'Сдача работ' },
  { stage: 'Монтаж', sub: 'Сдача работ', from: 'Монтажное подразделение', action: 'Сдача работ заказчику', to: 'Заказчик', deadline: 'По ГПР', doc: 'Акт сдачи-приёмки', trigger: '' },
  // --- ПТО ---
  { stage: 'ПТО', sub: 'АОСР кронштейны', from: 'Отдел ПТО', action: 'АОСР + исполнительные схемы: кронштейны, каркас', to: 'Руководитель проекта', deadline: 'По ГПР', doc: 'АОСР, Исп. схемы', trigger: '' },
  { stage: 'ПТО', sub: 'АОСР примыкания', from: 'Отдел ПТО', action: 'АОСР + исполнительные схемы: устройство примыкания', to: 'Руководитель проекта', deadline: 'По ГПР', doc: 'АОСР, Исп. схемы', trigger: '' },
  { stage: 'ПТО', sub: 'АОСР заполнения', from: 'Отдел ПТО', action: 'АОСР + исполнительные схемы: заполнения, открывающие', to: 'Руководитель проекта', deadline: 'По ГПР', doc: 'АОСР, Исп. схемы', trigger: '' },
  // --- Контроль ---
  { stage: 'Контроль', sub: 'Контроль сроков', from: 'Руководитель проекта', action: 'Постоянный контроль сроков выполнения по всем отделам', to: 'Все отделы', deadline: 'Постоянно', doc: 'ГПР', trigger: '' },
  { stage: 'Контроль', sub: 'Подписание актов', from: 'Руководитель проекта', action: 'Подписание выполненных работ в соответствии с приложением к договору', to: 'Заказчик', deadline: 'По договору', doc: 'Акты выполненных работ', trigger: '' },
  { stage: 'Контроль', sub: 'Уведомление об изменениях', from: 'Руководитель проекта', action: 'Уведомить договорной отдел об изменениях, влекущих доп. расходы или изменения объёмов', to: 'Договорной отдел', deadline: 'При возникновении', doc: 'Уведомление', trigger: 'Допсоглашение' },
];

export const STAGES = [...new Set(WORKFLOW.map(w => w.stage))];
