// ============================================================
// src/data/jobInstructions.ts
// Должностные инструкции и банк вопросов для квиза
// ============================================================

export type AppRole = 'director' | 'pm' | 'foreman' | 'pto' | 'supply' | 'warehouse' | 'designer' | 'inspector';

export interface QuizQuestion {
  id: string;
  question: string;
  options: string[];
  correctIndex: number; // 0-3
}

export interface JobInstruction {
  role: AppRole;
  title: string;
  sections: {
    heading: string;
    content: string;
  }[];
  questions: QuizQuestion[];
}

// ============================================================
// 1. ДИРЕКТОР
// ============================================================
const directorInstruction: JobInstruction = {
  role: 'director',
  title: 'Должностная инструкция: Директор',
  sections: [
    {
      heading: '1. Общие положения',
      content:
        'Директор является руководителем организации и несёт полную ответственность за результаты деятельности компании. ' +
        'Директор подчиняется учредителям/совету директоров. ' +
        'Назначение и освобождение от должности производится решением учредителей. ' +
        'В период отсутствия директора его обязанности исполняет назначенный заместитель.',
    },
    {
      heading: '2. Обязанности',
      content:
        '— Утверждать стратегию развития компании и ключевые показатели эффективности (KPI).\n' +
        '— Контролировать деятельность всех менеджеров проектов (PM): проверять еженедельные отчёты, анализировать отклонения от плана.\n' +
        '— Подписывать договоры с заказчиками, субподрядчиками и поставщиками на сумму свыше 500 000 руб.\n' +
        '— Утверждать бюджеты проектов и контролировать их исполнение.\n' +
        '— Проводить ежемесячные совещания по всем активным проектам.\n' +
        '— Принимать решения об эскалации проблем, которые не смог решить PM.\n' +
        '— Обеспечивать соблюдение требований охраны труда и техники безопасности на всех объектах.\n' +
        '— Подписывать финансовую отчётность компании.',
    },
    {
      heading: '3. Ответственность',
      content:
        'Директор несёт ответственность за:\n' +
        '— финансовые результаты всех проектов;\n' +
        '— соблюдение трудового законодательства;\n' +
        '— качество сдаваемых объектов;\n' +
        '— репутацию компании перед заказчиками;\n' +
        '— соблюдение сроков по всем проектам портфеля.',
    },
    {
      heading: '4. Работа в системе STSphera',
      content:
        'В системе директор имеет доступ ко всем проектам в режиме полного просмотра и редактирования. ' +
        'Директор получает сводный дашборд с ключевыми показателями по всем объектам: прогресс, бюджет, алерты, рейтинг команды. ' +
        'Все критические алерты (красный уровень) автоматически дублируются директору в Telegram. ' +
        'Директор может назначать и снимать роли сотрудников в системе.',
    },
    {
      heading: '5. Порядок эскалации',
      content:
        'Алерты уровня "Критично" требуют реакции директора в течение 4 часов. ' +
        'Если PM не закрыл проблему за 24 часа — директор обязан лично вмешаться. ' +
        'Решения директора фиксируются в системе в разделе "Алерты" с пометкой "Директорское решение".',
    },
  ],
  questions: [
    {
      id: 'd1',
      question: 'Какие договоры директор подписывает лично?',
      options: [
        'Все договоры без исключения',
        'Договоры на сумму свыше 500 000 руб.',
        'Только договоры с заказчиками',
        'Только договоры с субподрядчиками',
      ],
      correctIndex: 1,
    },
    {
      id: 'd2',
      question: 'В течение какого времени директор должен отреагировать на критический алерт?',
      options: ['1 час', '2 часа', '4 часа', '24 часа'],
      correctIndex: 2,
    },
    {
      id: 'd3',
      question: 'Что происходит, если PM не закрыл проблему за 24 часа?',
      options: [
        'Проблема автоматически закрывается системой',
        'Директор обязан лично вмешаться',
        'PM получает штраф',
        'Проблема передаётся прорабу',
      ],
      correctIndex: 1,
    },
    {
      id: 'd4',
      question: 'Как часто директор проводит совещания по активным проектам?',
      options: ['Еженедельно', 'Ежеквартально', 'Ежемесячно', 'По запросу PM'],
      correctIndex: 2,
    },
    {
      id: 'd5',
      question: 'Какой доступ имеет директор в системе STSphera?',
      options: [
        'Только просмотр',
        'Только свои проекты',
        'Все проекты — просмотр и редактирование',
        'Только финансовые данные',
      ],
      correctIndex: 2,
    },
    {
      id: 'd6',
      question: 'Кто исполняет обязанности директора в его отсутствие?',
      options: [
        'Старший PM',
        'Назначенный заместитель',
        'Главный прораб',
        'Обязанности не исполняются',
      ],
      correctIndex: 1,
    },
    {
      id: 'd7',
      question: 'За что несёт ответственность директор?',
      options: [
        'Только за финансовые результаты',
        'Только за соблюдение сроков',
        'За финансы, качество, сроки, ОТ и репутацию компании',
        'Только за работу PM',
      ],
      correctIndex: 2,
    },
    {
      id: 'd8',
      question: 'Куда дублируются критические алерты?',
      options: [
        'На email директора',
        'В Telegram директора',
        'В отдельный раздел системы',
        'Только в приложении',
      ],
      correctIndex: 1,
    },
  ],
};

// ============================================================
// 2. МЕНЕДЖЕР ПРОЕКТА (PM)
// ============================================================
const pmInstruction: JobInstruction = {
  role: 'pm',
  title: 'Должностная инструкция: Менеджер проекта (PM)',
  sections: [
    {
      heading: '1. Общие положения',
      content:
        'Менеджер проекта (PM) отвечает за полный цикл реализации строительного проекта — от старта до сдачи объекта заказчику. ' +
        'PM подчиняется непосредственно директору компании. ' +
        'В зоне ответственности PM находятся: прораб, ПТО, снабжение, кладовщик, проектировщики, инспектор.',
    },
    {
      heading: '2. Обязанности',
      content:
        '— Разрабатывать и актуализировать план-факт по проекту (ГПР).\n' +
        '— Координировать взаимодействие всех участников проекта.\n' +
        '— Вести переписку с заказчиком, фиксировать все договорённости.\n' +
        '— Проводить еженедельные планёрки с командой проекта.\n' +
        '— Контролировать бюджет проекта: отслеживать расходы, согласовывать дополнительные затраты.\n' +
        '— Формировать и согласовывать КС-2/КС-3 совместно с ПТО.\n' +
        '— Управлять рисками: выявлять, оценивать, вносить в реестр рисков.\n' +
        '— Закрывать алерты в системе или эскалировать директору.\n' +
        '— Загружать протоколы совещаний в систему в течение 24 часов после встречи.',
    },
    {
      heading: '3. Ответственность',
      content:
        'PM несёт ответственность за:\n' +
        '— соблюдение сроков проекта;\n' +
        '— соответствие расходов утверждённому бюджету;\n' +
        '— качество коммуникации с заказчиком;\n' +
        '— актуальность данных в системе STSphera;\n' +
        '— своевременное информирование директора о критических ситуациях.',
    },
    {
      heading: '4. Работа в системе STSphera',
      content:
        'PM имеет полный доступ к своим проектам. ' +
        'Обязан обновлять план-факт (ГПР) не реже одного раза в неделю (каждый понедельник). ' +
        'Загружать протоколы совещаний, переписку с заказчиком в раздел "Документы". ' +
        'Отрабатывать все алерты в течение 24 часов после их появления. ' +
        'Алерты красного уровня — в течение 4 часов.',
    },
    {
      heading: '5. Коммуникация',
      content:
        'Все решения по изменению объёма, стоимости или сроков проекта фиксируются письменно. ' +
        'Устные договорённости с заказчиком в тот же день дублируются в мессенджер и загружаются в систему. ' +
        'PM обязан быть доступен в рабочее время (9:00–18:00) по телефону и в Telegram.',
    },
  ],
  questions: [
    {
      id: 'pm1',
      question: 'Как часто PM обязан обновлять план-факт (ГПР)?',
      options: ['Ежедневно', 'Раз в две недели', 'Каждый понедельник', 'По запросу директора'],
      correctIndex: 2,
    },
    {
      id: 'pm2',
      question: 'В течение какого времени нужно загрузить протокол совещания?',
      options: ['В тот же день', 'В течение 24 часов', 'В течение 48 часов', 'В течение недели'],
      correctIndex: 1,
    },
    {
      id: 'pm3',
      question: 'Алерт красного уровня PM должен закрыть за:',
      options: ['1 час', '4 часа', '12 часов', '24 часа'],
      correctIndex: 1,
    },
    {
      id: 'pm4',
      question: 'Кому подчиняется PM?',
      options: ['Прорабу', 'ПТО', 'Директору компании', 'Заказчику'],
      correctIndex: 2,
    },
    {
      id: 'pm5',
      question: 'Что PM делает с устными договорённостями с заказчиком?',
      options: [
        'Запоминает и применяет',
        'Фиксирует в тетради',
        'В тот же день дублирует в мессенджер и загружает в систему',
        'Сообщает директору устно',
      ],
      correctIndex: 2,
    },
    {
      id: 'pm6',
      question: 'Какие документы PM формирует совместно с ПТО?',
      options: ['Договоры', 'КС-2/КС-3', 'Накладные', 'Наряд-задания'],
      correctIndex: 1,
    },
    {
      id: 'pm7',
      question: 'Кто находится в зоне ответственности PM?',
      options: [
        'Только прораб',
        'Прораб, ПТО, снабжение, кладовщик, проектировщики, инспектор',
        'Только ПТО и снабжение',
        'Вся компания',
      ],
      correctIndex: 1,
    },
    {
      id: 'pm8',
      question: 'Как часто PM проводит планёрки с командой?',
      options: ['Ежедневно', 'Еженедельно', 'Ежемесячно', 'По необходимости'],
      correctIndex: 1,
    },
  ],
};

// ============================================================
// 3. ПРОРАБ (FOREMAN)
// ============================================================
const foremanInstruction: JobInstruction = {
  role: 'foreman',
  title: 'Должностная инструкция: Прораб',
  sections: [
    {
      heading: '1. Общие положения',
      content:
        'Прораб (производитель работ) организует и контролирует строительно-монтажные работы непосредственно на объекте. ' +
        'Прораб подчиняется менеджеру проекта (PM). ' +
        'В подчинении прораба находятся бригадиры и рабочие на объекте.',
    },
    {
      heading: '2. Обязанности',
      content:
        '— Организовывать ежедневное выполнение работ согласно ГПР.\n' +
        '— Ежедневно фиксировать факт выполнения работ в системе (до 18:00).\n' +
        '— Загружать фотоотчёты с объекта — минимум 3 фото в день.\n' +
        '— Контролировать соблюдение технологии выполнения работ.\n' +
        '— Вести табель учёта рабочего времени бригады.\n' +
        '— Немедленно сообщать PM о любых отклонениях от проекта или сроков.\n' +
        '— Обеспечивать наличие на объекте необходимых материалов: подавать заявки на снабжение за 3 дня.\n' +
        '— Контролировать соблюдение требований охраны труда всеми рабочими.',
    },
    {
      heading: '3. Ответственность',
      content:
        'Прораб несёт ответственность за:\n' +
        '— качество выполненных работ на своём участке;\n' +
        '— соблюдение технологической последовательности;\n' +
        '— безопасность рабочих на объекте;\n' +
        '— сохранность материалов и оборудования;\n' +
        '— достоверность данных в ежедневных отчётах.',
    },
    {
      heading: '4. Работа в системе STSphera',
      content:
        'Прораб работает в мобильном приложении STSphera. ' +
        'Ежедневно до 18:00 вносит данные о выполненных работах по каждому этажу/участку. ' +
        'Загружает фотографии с геометкой. ' +
        'Оформляет наряд-задания на бригаду. ' +
        'Отмечает расход материалов.',
    },
    {
      heading: '5. Заявки на материалы',
      content:
        'Заявка на материалы подаётся через раздел "Снабжение" в системе за 3 рабочих дня до необходимой даты поставки. ' +
        'В заявке обязательно указывать: наименование, количество, единицу измерения, дату "нужно к". ' +
        'Телефонные заявки снабженцу без фиксации в системе не принимаются.',
    },
    {
      heading: '6. Охрана труда',
      content:
        'Прораб обязан провести инструктаж каждого нового рабочего до начала работ. ' +
        'Факт инструктажа фиксируется в журнале ОТ с подписью рабочего. ' +
        'Рабочие без СИЗ (каски, жилеты) к работам не допускаются. ' +
        'При несчастном случае — немедленно сообщить PM и директору.',
    },
  ],
  questions: [
    {
      id: 'f1',
      question: 'До какого времени прораб должен внести данные о выполненных работах?',
      options: ['До 12:00', 'До 15:00', 'До 18:00', 'До 20:00'],
      correctIndex: 2,
    },
    {
      id: 'f2',
      question: 'Сколько минимум фотографий должен загрузить прораб в день?',
      options: ['1', '2', '3', '5'],
      correctIndex: 2,
    },
    {
      id: 'f3',
      question: 'За сколько дней подаётся заявка на материалы?',
      options: ['За 1 день', 'За 3 дня', 'За 5 дней', 'За неделю'],
      correctIndex: 1,
    },
    {
      id: 'f4',
      question: 'Допускаются ли телефонные заявки снабженцу без фиксации в системе?',
      options: [
        'Да, в срочных случаях',
        'Да, всегда',
        'Нет, не принимаются',
        'Да, если нет интернета',
      ],
      correctIndex: 2,
    },
    {
      id: 'f5',
      question: 'Что делает прораб при несчастном случае на объекте?',
      options: [
        'Самостоятельно решает проблему',
        'Пишет отчёт в конце дня',
        'Немедленно сообщает PM и директору',
        'Вызывает скорую и молчит',
      ],
      correctIndex: 2,
    },
    {
      id: 'f6',
      question: 'Кому подчиняется прораб?',
      options: ['Директору', 'ПТО', 'Менеджеру проекта (PM)', 'Заказчику'],
      correctIndex: 2,
    },
    {
      id: 'f7',
      question: 'Когда проводится инструктаж нового рабочего?',
      options: [
        'В конце первого рабочего дня',
        'До начала работ',
        'После пробной смены',
        'По требованию ПТО',
      ],
      correctIndex: 1,
    },
    {
      id: 'f8',
      question: 'Что указывается в заявке на материалы?',
      options: [
        'Только наименование и количество',
        'Наименование, количество, единица измерения, дата "нужно к"',
        'Только дата и количество',
        'Наименование и поставщик',
      ],
      correctIndex: 1,
    },
  ],
};

// ============================================================
// 4. ПТО (Производственно-технический отдел)
// ============================================================
const ptoInstruction: JobInstruction = {
  role: 'pto',
  title: 'Должностная инструкция: Специалист ПТО',
  sections: [
    {
      heading: '1. Общие положения',
      content:
        'Специалист производственно-технического отдела (ПТО) обеспечивает техническое и документальное сопровождение строительного проекта. ' +
        'ПТО подчиняется менеджеру проекта (PM).',
    },
    {
      heading: '2. Обязанности',
      content:
        '— Разрабатывать и актуализировать исполнительную документацию.\n' +
        '— Оформлять акты освидетельствования скрытых работ до закрытия конструкций.\n' +
        '— Готовить КС-2 (акт о приёмке выполненных работ) и КС-3 (справку о стоимости) ежемесячно.\n' +
        '— Вести журналы работ: общий и специальные.\n' +
        '— Контролировать наличие сертификатов и паспортов на все применяемые материалы.\n' +
        '— Обеспечивать соответствие выполненных работ проектной документации.\n' +
        '— Участвовать в контрольных замерах совместно с представителем заказчика.\n' +
        '— Загружать все документы в систему STSphera в установленные сроки.',
    },
    {
      heading: '3. Критически важно',
      content:
        'Акт скрытых работ оформляется ДО закрытия конструкции (заливки бетона, закрытия стен и т.д.). ' +
        'Нарушение этого правила может привести к отказу заказчика принять работы и штрафным санкциям. ' +
        'При отсутствии акта скрытых работ — работы считаются не выполненными.',
    },
    {
      heading: '4. Работа в системе STSphera',
      content:
        'ПТО загружает в систему: КС-2/КС-3, акты скрытых работ, исполнительные схемы, журналы, сертификаты. ' +
        'Каждый документ привязывается к конкретному этажу, этапу и дате. ' +
        'Система отправляет напоминание ПТО, если КС-2 не загружена до 25-го числа месяца.',
    },
    {
      heading: '5. Ответственность',
      content:
        'ПТО несёт ответственность за:\n' +
        '— комплектность и качество исполнительной документации;\n' +
        '— своевременное оформление актов скрытых работ;\n' +
        '— наличие сертификатов на материалы;\n' +
        '— корректность объёмов в КС-2.',
    },
  ],
  questions: [
    {
      id: 'pto1',
      question: 'Когда оформляется акт освидетельствования скрытых работ?',
      options: [
        'После закрытия конструкции',
        'В конце месяца',
        'До закрытия конструкции',
        'По требованию заказчика',
      ],
      correctIndex: 2,
    },
    {
      id: 'pto2',
      question: 'До какого числа КС-2 должна быть загружена в систему?',
      options: ['До 20-го', 'До 25-го', 'До последнего дня месяца', 'До 1-го следующего месяца'],
      correctIndex: 1,
    },
    {
      id: 'pto3',
      question: 'Что происходит, если акт скрытых работ не оформлен?',
      options: [
        'Работы принимаются с замечанием',
        'Работы считаются не выполненными',
        'ПТО получает предупреждение',
        'Ничего, это формальность',
      ],
      correctIndex: 1,
    },
    {
      id: 'pto4',
      question: 'КС-2 и КС-3 готовятся с какой периодичностью?',
      options: ['Еженедельно', 'Ежеквартально', 'Ежемесячно', 'По окончании проекта'],
      correctIndex: 2,
    },
    {
      id: 'pto5',
      question: 'К чему привязывается каждый документ в системе?',
      options: [
        'Только к дате',
        'К конкретному этажу, этапу и дате',
        'К имени загрузившего',
        'К категории документа',
      ],
      correctIndex: 1,
    },
    {
      id: 'pto6',
      question: 'Что должен проверить ПТО для всех применяемых материалов?',
      options: [
        'Только цену',
        'Наличие сертификатов и паспортов',
        'Количество на складе',
        'Дату поставки',
      ],
      correctIndex: 1,
    },
  ],
};

// ============================================================
// 5. СНАБЖЕНЕЦ (SUPPLY)
// ============================================================
const supplyInstruction: JobInstruction = {
  role: 'supply',
  title: 'Должностная инструкция: Специалист по снабжению',
  sections: [
    {
      heading: '1. Общие положения',
      content:
        'Специалист по снабжению обеспечивает своевременную поставку материалов, оборудования и инструментов на строительный объект. ' +
        'Подчиняется менеджеру проекта (PM).',
    },
    {
      heading: '2. Обязанности',
      content:
        '— Принимать заявки от прораба через систему STSphera.\n' +
        '— Обрабатывать заявку в течение 24 часов: подтверждать или запрашивать уточнение.\n' +
        '— Искать поставщиков, запрашивать коммерческие предложения (минимум 2–3 на позицию).\n' +
        '— Согласовывать выбор поставщика с PM при стоимости позиции свыше 50 000 руб.\n' +
        '— Контролировать сроки поставки: за 1 день уточнять у поставщика статус.\n' +
        '— Обновлять статус заявок в системе: "В работе", "Заказано", "Отгружено", "Доставлено".\n' +
        '— Загружать счета и накладные поставщиков в систему.\n' +
        '— Вести реестр поставщиков с оценкой по критериям: цена, сроки, качество.',
    },
    {
      heading: '3. Приоритеты в работе',
      content:
        'Заявки обрабатываются в порядке приоритетности:\n' +
        '1) Критично (объект стоит) — в течение 4 часов.\n' +
        '2) Срочно (срок через 1–2 дня) — в течение 12 часов.\n' +
        '3) Планово (срок через 3+ дня) — в течение 24 часов.',
    },
    {
      heading: '4. Работа в системе STSphera',
      content:
        'Все заявки видны в разделе "Снабжение". ' +
        'Снабженец обязан менять статус заявки при каждом изменении. ' +
        'К каждой закрытой заявке прикрепляется скан накладной или счёта.',
    },
    {
      heading: '5. Ответственность',
      content:
        'Снабженец несёт ответственность за:\n' +
        '— срыв поставок по своей вине;\n' +
        '— завышение цен без обоснования;\n' +
        '— работу с поставщиками, не прошедшими проверку;\n' +
        '— достоверность статусов заявок в системе.',
    },
  ],
  questions: [
    {
      id: 's1',
      question: 'В течение какого времени снабженец обрабатывает критическую заявку (объект стоит)?',
      options: ['1 час', '4 часа', '12 часов', '24 часа'],
      correctIndex: 1,
    },
    {
      id: 's2',
      question: 'При стоимости позиции свыше какой суммы нужно согласовывать поставщика с PM?',
      options: ['10 000 руб.', '25 000 руб.', '50 000 руб.', '100 000 руб.'],
      correctIndex: 2,
    },
    {
      id: 's3',
      question: 'Сколько минимум коммерческих предложений нужно собрать на позицию?',
      options: ['1', '2–3', '5', 'Не регламентировано'],
      correctIndex: 1,
    },
    {
      id: 's4',
      question: 'Какие статусы заявки использует снабженец?',
      options: [
        '"Новая", "Закрыта"',
        '"Да", "Нет"',
        '"В работе", "Заказано", "Отгружено", "Доставлено"',
        '"Принято", "Отклонено"',
      ],
      correctIndex: 2,
    },
    {
      id: 's5',
      question: 'Когда снабженец уточняет статус у поставщика?',
      options: ['За 3 дня', 'За 1 день до поставки', 'В день поставки', 'После доставки'],
      correctIndex: 1,
    },
    {
      id: 's6',
      question: 'Что прикрепляется к каждой закрытой заявке?',
      options: [
        'Фото товара',
        'Скан накладной или счёта',
        'Подпись директора',
        'Ничего дополнительно',
      ],
      correctIndex: 1,
    },
  ],
};

// ============================================================
// 6. КЛАДОВЩИК (WAREHOUSE)
// ============================================================
const warehouseInstruction: JobInstruction = {
  role: 'warehouse',
  title: 'Должностная инструкция: Кладовщик',
  sections: [
    {
      heading: '1. Общие положения',
      content:
        'Кладовщик обеспечивает приёмку, хранение, учёт и выдачу материалов на строительном объекте. ' +
        'Подчиняется менеджеру проекта (PM) и прорабу в оперативных вопросах.',
    },
    {
      heading: '2. Обязанности',
      content:
        '— Принимать материалы по количеству и качеству согласно накладной.\n' +
        '— При приёмке сверять фактическое количество с накладной — расхождения фиксировать.\n' +
        '— Вносить приход материалов в систему STSphera в день поставки.\n' +
        '— Выдавать материалы только по подписанной прорабом наряд-заявке.\n' +
        '— Еженедельно проводить инвентаризацию остатков.\n' +
        '— Хранить материалы в соответствии с требованиями производителя.\n' +
        '— При выявлении брака или недостачи немедленно уведомлять снабженца и PM.',
    },
    {
      heading: '3. Работа в системе STSphera',
      content:
        'Кладовщик вносит каждую приёмку и выдачу в систему. ' +
        'Раздел "Кладовщик" отображает текущие остатки. ' +
        'Система автоматически уведомляет прораба и снабженца, когда остаток материала опускается ниже минимального уровня.',
    },
    {
      heading: '4. Ответственность',
      content:
        'Кладовщик несёт материальную ответственность за:\n' +
        '— сохранность всех материалов на складе;\n' +
        '— правильность учёта прихода и расхода;\n' +
        '— своевременное внесение данных в систему.',
    },
  ],
  questions: [
    {
      id: 'w1',
      question: 'Когда кладовщик вносит приход материалов в систему?',
      options: ['На следующий день', 'В конце недели', 'В день поставки', 'После инвентаризации'],
      correctIndex: 2,
    },
    {
      id: 'w2',
      question: 'На основании чего выдаются материалы?',
      options: [
        'Устной просьбы прораба',
        'Заявки в Telegram',
        'Подписанной прорабом наряд-заявки',
        'Любого документа',
      ],
      correctIndex: 2,
    },
    {
      id: 'w3',
      question: 'Как часто проводится инвентаризация?',
      options: ['Ежедневно', 'Еженедельно', 'Ежемесячно', 'По запросу PM'],
      correctIndex: 1,
    },
    {
      id: 'w4',
      question: 'Что делает кладовщик при выявлении брака?',
      options: [
        'Списывает самостоятельно',
        'Использует всё равно',
        'Немедленно уведомляет снабженца и PM',
        'Возвращает поставщику без уведомления',
      ],
      correctIndex: 2,
    },
    {
      id: 'w5',
      question: 'Что происходит при расхождении фактического количества с накладной?',
      options: [
        'Принимается по накладной без вопросов',
        'Расхождения фиксируются',
        'Всё возвращается поставщику',
        'Кладовщик доплачивает разницу',
      ],
      correctIndex: 1,
    },
  ],
};

// ============================================================
// 7. ПРОЕКТИРОВЩИК (DESIGNER)
// ============================================================
const designerInstruction: JobInstruction = {
  role: 'designer',
  title: 'Должностная инструкция: Проектировщик',
  sections: [
    {
      heading: '1. Общие положения',
      content:
        'Проектировщик разрабатывает и сопровождает проектную и рабочую документацию в ходе строительного проекта. ' +
        'Подчиняется менеджеру проекта (PM).',
    },
    {
      heading: '2. Обязанности',
      content:
        '— Разрабатывать рабочую документацию (КМ, ОПР, узлы, детали, альбомы).\n' +
        '— Согласовывать чертежи с заказчиком и экспертизой в установленные сроки.\n' +
        '— Выпускать изменения и дополнения к проекту (РД) и уведомлять прораба и ПТО.\n' +
        '— Загружать актуальные версии чертежей в систему с указанием ревизии.\n' +
        '— Участвовать в совещаниях по техническим вопросам.\n' +
        '— Отвечать на запросы прораба об уточнении проектных решений в течение 24 часов.',
    },
    {
      heading: '3. Управление версиями документов',
      content:
        'Каждый чертёж имеет номер ревизии (Rev.0, Rev.1, Rev.2…). ' +
        'Загружая новую версию в систему — старая архивируется автоматически. ' +
        'На объекте используется только актуальная ревизия. ' +
        'Прораб получает уведомление при выходе новой ревизии.',
    },
    {
      heading: '4. Работа в системе STSphera',
      content:
        'Все чертежи хранятся в разделе "Документы → Проектировщики". ' +
        'Файлы загружаются в форматах PDF и DWG. ' +
        'К каждому файлу обязательно указываются: раздел (КМ/ОПР/…), номер листа, ревизия.',
    },
  ],
  questions: [
    {
      id: 'des1',
      question: 'В течение какого времени проектировщик отвечает на запрос прораба?',
      options: ['1 час', '4 часа', '24 часа', '3 дня'],
      correctIndex: 2,
    },
    {
      id: 'des2',
      question: 'Что обозначает Rev.2 на чертеже?',
      options: [
        'Второй экземпляр документа',
        'Вторая редакция (ревизия) документа',
        'Второй раздел документа',
        'Документ для второго этажа',
      ],
      correctIndex: 1,
    },
    {
      id: 'des3',
      question: 'Какая версия чертежа используется на объекте?',
      options: [
        'Самая первая',
        'Любая имеющаяся',
        'Только актуальная ревизия',
        'Та, которую удобно прорабу',
      ],
      correctIndex: 2,
    },
    {
      id: 'des4',
      question: 'Что происходит со старой версией чертежа при загрузке новой?',
      options: [
        'Удаляется навсегда',
        'Архивируется автоматически',
        'Остаётся активной',
        'Отправляется заказчику',
      ],
      correctIndex: 1,
    },
    {
      id: 'des5',
      question: 'В каких форматах загружаются файлы в систему?',
      options: ['Только PDF', 'Только DWG', 'PDF и DWG', 'Любые форматы'],
      correctIndex: 2,
    },
    {
      id: 'des6',
      question: 'Кого уведомляет проектировщик при выпуске изменений?',
      options: [
        'Только заказчика',
        'Только PM',
        'Прораба и ПТО',
        'Никого, документы сами говорят за себя',
      ],
      correctIndex: 2,
    },
  ],
};

// ============================================================
// 8. ИНСПЕКТОР / ТН (INSPECTOR)
// ============================================================
const inspectorInstruction: JobInstruction = {
  role: 'inspector',
  title: 'Должностная инструкция: Инспектор (Технадзор)',
  sections: [
    {
      heading: '1. Общие положения',
      content:
        'Инспектор (специалист технического надзора — ТН) осуществляет независимый контроль качества строительно-монтажных работ в интересах заказчика или компании. ' +
        'Инспектор подчиняется менеджеру проекта (PM) и директору.',
    },
    {
      heading: '2. Обязанности',
      content:
        '— Проводить плановые и внеплановые проверки объекта.\n' +
        '— Фиксировать выявленные нарушения и дефекты с фотоподтверждением.\n' +
        '— Выдавать предписания на устранение нарушений с указанием срока.\n' +
        '— Контролировать устранение нарушений в установленные сроки.\n' +
        '— Участвовать в приёмке скрытых работ совместно с ПТО.\n' +
        '— Составлять еженедельный отчёт о состоянии качества на объекте.\n' +
        '— Останавливать работы при выявлении угрозы безопасности или грубом нарушении технологии.',
    },
    {
      heading: '3. Предписания',
      content:
        'Предписание выдаётся в письменном виде (или в системе STSphera) с обязательным указанием:\n' +
        '— описания нарушения;\n' +
        '— нормативного требования, которое нарушено;\n' +
        '— срока устранения;\n' +
        '— ответственного лица.\n' +
        'Прораб расписывается за получение предписания. ' +
        'Нарушение, указанное в предписании, не устранённое в срок — немедленно эскалируется PM и директору.',
    },
    {
      heading: '4. Право остановки работ',
      content:
        'Инспектор имеет право остановить работы при:\n' +
        '— угрозе жизни и здоровью работников;\n' +
        '— грубом нарушении технологии, которое невозможно устранить без переделки;\n' +
        '— отсутствии актов скрытых работ при закрытии конструкций.\n' +
        'О факте остановки немедленно уведомляется PM и директор.',
    },
    {
      heading: '5. Работа в системе STSphera',
      content:
        'Инспектор создаёт алерты в системе по каждому нарушению. ' +
        'К каждому алерту прикрепляются фотографии и описание. ' +
        'Алерт закрывается только после фотофиксации устранения нарушения инспектором.',
    },
  ],
  questions: [
    {
      id: 'i1',
      question: 'Кто закрывает алерт о нарушении в системе?',
      options: [
        'Прораб после устранения',
        'PM автоматически',
        'Инспектор после фотофиксации устранения',
        'Директор',
      ],
      correctIndex: 2,
    },
    {
      id: 'i2',
      question: 'Что обязательно указывается в предписании?',
      options: [
        'Только описание нарушения',
        'Нарушение, норматив, срок, ответственный',
        'Только срок устранения',
        'Имя нарушителя и штраф',
      ],
      correctIndex: 1,
    },
    {
      id: 'i3',
      question: 'В каком случае инспектор может остановить работы?',
      options: [
        'По своему усмотрению в любой момент',
        'Только с разрешения директора',
        'При угрозе жизни, грубом нарушении технологии или отсутствии актов скрытых работ',
        'Только при угрозе жизни',
      ],
      correctIndex: 2,
    },
    {
      id: 'i4',
      question: 'Что происходит с нарушением, не устранённым в срок?',
      options: [
        'Срок автоматически продлевается',
        'Нарушение списывается',
        'Немедленно эскалируется PM и директору',
        'Выписывается повторное предписание',
      ],
      correctIndex: 2,
    },
    {
      id: 'i5',
      question: 'Как часто инспектор составляет отчёт о качестве?',
      options: ['Ежедневно', 'Еженедельно', 'Ежемесячно', 'По каждому факту нарушения'],
      correctIndex: 1,
    },
    {
      id: 'i6',
      question: 'Кто расписывается за получение предписания?',
      options: ['PM', 'Директор', 'Прораб', 'Кладовщик'],
      correctIndex: 2,
    },
  ],
};

// ============================================================
// ЭКСПОРТ ВСЕХ ИНСТРУКЦИЙ
// ============================================================

export const JOB_INSTRUCTIONS: Record<AppRole, JobInstruction> = {
  director: directorInstruction,
  pm: pmInstruction,
  foreman: foremanInstruction,
  pto: ptoInstruction,
  supply: supplyInstruction,
  warehouse: warehouseInstruction,
  designer: designerInstruction,
  inspector: inspectorInstruction,
};

/**
 * Возвращает 4 случайных вопроса для квиза по указанной роли
 */
export function getRandomQuizQuestions(role: AppRole): QuizQuestion[] {
  const allQuestions = JOB_INSTRUCTIONS[role].questions;
  const shuffled = [...allQuestions].sort(() => Math.random() - 0.5);
  return shuffled.slice(0, 4);
}

/**
 * Проверяет результат квиза
 * Возвращает true если правильных ≥ 3 из 4
 */
export function isQuizPassed(
  questions: QuizQuestion[],
  answers: number[] // индекс выбранного варианта для каждого вопроса
): { passed: boolean; score: number; total: number } {
  const correct = questions.reduce((acc, q, i) => {
    return acc + (answers[i] === q.correctIndex ? 1 : 0);
  }, 0);
  return {
    passed: correct >= 3,
    score: correct,
    total: questions.length,
  };
}
