# AUDIT ‚Äî STSphera (Telegram Mini App)

–î–∞—Ç–∞: 2025-02-18
–ü—Ä–æ–µ–∫—Ç: porbotenet-wq-my-telegram-mini

---

## 1. –°–¢–ï–ö

- Frontend: React 18 + TypeScript + Vite + Tailwind CSS + shadcn/ui
- Backend: Supabase (PostgreSQL + Edge Functions + Storage + Auth)
- Bot: Supabase Edge Functions (telegram-bot, telegram-bot-webhook, telegram-notify, telegram-manage, telegram-scheduler)
- AI: Edge Function ai-chat (streaming), analyze-document, parse-project-document
- PWA: Service Worker, manifest.json, offline support
- –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Å–±–æ—Ä–∫–∏: Lovable.dev (low-code, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø—Ä–æ–º–ø—Ç—ã)

## 2. –ê–†–•–ò–¢–ï–ö–¢–£–†–ê ‚Äî –ß–¢–û –ï–°–¢–¨

### Frontend (Mini App)
- –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π SPA, –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ –æ–¥–Ω–æ–π –ø–∞–ø–∫–µ src/components/
- –†–æ—É—Ç–∏–Ω–≥: react-router-dom, –Ω–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ 1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (Index.tsx) —Å —Ç–∞–±–∞–º–∏
- State: –ª–æ–∫–∞–ª—å–Ω—ã–π useState, –Ω–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å—Ç–æ—Ä–∞
- Data fetching: –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã supabase client, —á–∞—Å—Ç–∏—á–Ω–æ react-query (–ø–æ–¥–∫–ª—é—á—ë–Ω, –Ω–æ –º–∞–ª–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- Auth: Supabase Auth (email/password) + legacy PIN-–ª–æ–≥–∏–Ω (LoginScreen.tsx)
- RBAC: roleConfig.ts ‚Äî –∫–æ–Ω—Ñ–∏–≥ —Ä–æ–ª–µ–π –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ, –Ω–æ –Ω–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- Gamification: XP —Å–∏—Å—Ç–µ–º–∞, –±–µ–π–¥–∂–∏, –ª–∏–¥–µ—Ä–±–æ—Ä–¥
- Onboarding: –¥–æ–ª–∂–Ω–æ—Å—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ + –∫–≤–∏–∑

### Backend (Supabase)
- 22 –º–∏–≥—Ä–∞—Ü–∏–∏ –∑–∞ 2 –¥–Ω—è (16-18 —Ñ–µ–≤—Ä–∞–ª—è 2026) ‚Äî –±—ã—Å—Ç—Ä–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è
- Edge Functions: telegram-bot, ai-chat, google-sheets-sync, analyze-document, parse-project-document, telegram-notify, telegram-manage, telegram-scheduler
- Storage: photo-reports, project-documents

### Telegram Bot
- Edge Functions –¥–ª—è webhook –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ telegram-notify
- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —á–µ—Ä–µ–∑ telegram-scheduler

## 3. –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### üî¥ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
1. **RBAC —Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ** ‚Äî roleConfig.ts –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. Supabase RLS policies –Ω–µ –≤–∏–¥–Ω—ã, –Ω–æ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã. –õ—é–±–æ–π –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å API –Ω–∞–ø—Ä—è–º—É—é.
2. **PIN "1234" –¥–ª—è –≤—Å–µ—Ö —Ä–æ–ª–µ–π** ‚Äî LoginScreen.tsx —Å–æ–¥–µ—Ä–∂–∏—Ç —Ö–∞—Ä–¥–∫–æ–¥ PIN. –≠—Ç–æ –¥–µ–º–æ-—Ä–µ–∂–∏–º, –Ω–æ –æ–Ω –≤ –ø—Ä–æ–¥–∞–∫—à–Ω –∫–æ–¥–µ.
3. **Supabase –∫–ª—é—á–∏ –≤ env** ‚Äî VITE_SUPABASE_PUBLISHABLE_KEY –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º –∫–æ–¥–µ (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è anon key, –Ω–æ –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ RLS –Ω–∞—Å—Ç—Ä–æ–µ–Ω).
4. **AI chat endpoint** ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ anon key, –Ω–µ—Ç rate limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
5. **WebApp initData** ‚Äî –Ω–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Telegram WebApp initData (HMAC-SHA256). –õ—é–±–æ–π –º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å Mini App –±–µ–∑ Telegram.

### üî¥ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
6. **–ù–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å–ª–æ—ë–≤** ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É, data fetching, UI –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ. CreateProjectWizard.tsx ‚Äî 500+ —Å—Ç—Ä–æ–∫.
7. **–ù–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å—Ç–µ–π—Ç–∞** ‚Äî –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–∞–º –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ. –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–µ—Ç –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.
8. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî AuthScreen.tsx –∏ LoginScreen.tsx ‚Äî –¥–≤–∞ —ç–∫—Ä–∞–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ –∫–∞–∫–æ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.
9. **–ù–µ—Ç —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –ë–î** ‚Äî integrations/supabase/types.ts —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `any` –ø–æ–≤—Å–µ–º–µ—Å—Ç–Ω–æ.
10. **–ù–µ—Ç —Ç–µ—Å—Ç–æ–≤** ‚Äî —Ç–æ–ª—å–∫–æ example.test.ts (–ø—É—Å—Ç–æ–π).

### üü° UX
11. **–ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–π Index.tsx** ‚Äî –≤–µ—Ä–æ—è—Ç–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ç–∞–±—ã –∏ –ª–æ–≥–∏–∫—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è.
12. **–ù–µ—Ç error boundaries** ‚Äî –ø–∞–¥–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Ä–æ–Ω—è–µ—Ç –≤—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
13. **–ù–µ—Ç —Å–∫–µ–ª–µ—Ç–æ–Ω–æ–≤** ‚Äî —Ç–æ–ª—å–∫–æ Loader2 —Å–ø–∏–Ω–Ω–µ—Ä—ã.
14. **Inline —Å—Ç–∏–ª–∏** ‚Äî –º–Ω–æ–≥–æ className —Å—Ç—Ä–æ–∫ –ø–æ 200+ —Å–∏–º–≤–æ–ª–æ–≤, —Ç—è–∂–µ–ª–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å.

### üü° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
15. **–ù–µ—Ç lazy loading** ‚Äî –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å—Ä–∞–∑—É.
16. **–ù–µ—Ç –º–µ–º–æ–∏–∑–∞—Ü–∏–∏** ‚Äî useEffect –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –ª–∏—à–Ω–∏–µ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä—ã.
17. **Recharts** ‚Äî —Ç—è–∂—ë–ª–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞, –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∞–∂–µ –∫–æ–≥–¥–∞ –≥—Ä–∞—Ñ–∏–∫–∏ –Ω–µ –Ω—É–∂–Ω—ã.

## 4. –ß–¢–û –°–î–ï–õ–ê–ù–û –•–û–†–û–®–û

- PWA —Å offline support, service worker, push notifications
- Gamification (XP, –±–µ–π–¥–∂–∏, –ª–∏–¥–µ—Ä–±–æ—Ä–¥) ‚Äî —Ö–æ—Ä–æ—à–∞—è –∏–¥–µ—è –¥–ª—è –≤–æ–≤–ª–µ—á–µ–Ω–∏—è –ø—Ä–æ—Ä–∞–±–æ–≤
- AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å streaming
- –î–æ–∫—É–º–µ–Ω—Ç—ã —Å AI-–∞–Ω–∞–ª–∏–∑–æ–º
- –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å —Ç–∏–ø–∞–º–∏ —Å–æ–±—ã—Ç–∏–π –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å –ì–ü–†
- Photo upload —Å –ø—Ä–µ–≤—å—é
- –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (AI –ø–∞—Ä—Å–∏–Ω–≥ –¥–æ–≥–æ–≤–æ—Ä–∞)
- Onboarding flow —Å –∫–≤–∏–∑–æ–º ‚Äî –æ—Ç–ª–∏—á–Ω–∞—è –∏–¥–µ—è

## 5. –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò ‚Äî –ü–†–ò–û–†–ò–¢–ï–¢

### P0 (–ë–ª–æ–∫–µ—Ä—ã ‚Äî –¥–æ –ø—Ä–æ–¥–∞–∫—à–Ω–∞)
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Supabase RLS policies –¥–ª—è –í–°–ï–• —Ç–∞–±–ª–∏—Ü
2. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é Telegram WebApp initData –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
3. –£–±—Ä–∞—Ç—å PIN-–ª–æ–≥–∏–Ω –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ dev-only
4. –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–æ–ª–µ–π –≤ Edge Functions

### P1 (–°–ª–µ–¥—É—é—â–∏–π —Å–ø—Ä–∏–Ω—Ç)
5. –í—ã–Ω–µ—Å—Ç–∏ data fetching –≤ –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ö—É–∫–∏ (useProjects, useDailyLogs, etc.)
6. –ü–æ–¥–∫–ª—é—á–∏—Ç—å react-query –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
7. –†–∞–∑–±–∏—Ç—å –∫—Ä—É–ø–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (CreateProjectWizard ‚Üí –æ—Ç–¥–µ–ª—å–Ω—ã–µ step-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
8. –î–æ–±–∞–≤–∏—Ç—å Supabase types generation (supabase gen types)
9. –î–æ–±–∞–≤–∏—Ç—å error boundaries

### P2 (–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥)
10. Lazy loading –¥–ª—è —Ç—è–∂—ë–ª—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (Recharts, Calendar, Documents)
11. –í—ã–Ω–µ—Å—Ç–∏ —Å—Ç–∏–ª–∏ –≤ Tailwind –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã / variants
12. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö flows (auth, —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞, –æ—Ç—á—ë—Ç)
13. –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ AuthScreen / LoginScreen
